---
layout: default
---

<head>
    <link rel="stylesheet" href="../../css/index.css">
</head>

<body>
<!-- Side navigation -->
<div class="sidenav">
    <a href="../../index.html" class="nav1">Introduction</a>
    <a href="../gettingstarted.html" class="nav1">Getting started</a>
    <a href="../modulelist.html" class="nav1">Modules</a>
    <a href="../macrolist.html" class="nav1">Macros</a>
    <!-- <a href="../extendingmia.html" class="nav1">Extending MIA</a> -->
</div>

<!-- Page content -->
<div class="main">
    <!--The following is replaced automatically by the generated module list-->
    <a href="../modulelist.html">Back to module list</a>
<h1>Best focus stack</h1>
<h2>Description</h2>
Extract a Z-substack from an input stack based on either manually-selected slices, or an automatically-calculated best-focus slice.  For automated methods, best focus is determined using intensity statistics (e.g. largest variance) of all pixels in each slice.  When in manual mode, only the best focus slice for the first and last timepoints need be specified (all others will be estimated using polynomial spline interpolation); however, more frames can be specified if preferred.<br><br>Irrespective of the calculation method (manual or automatic), it's possible to extract a fixed number of slices above and below the determined best-focus slice.
<h2>Parameters</h2>
<ul><li><b>Input image</b> (default = "") Image to extract substack from.</li><br><li><b>Output mode</b> (default = "Calculate and apply") Controls whether the best focus positions are calculated and applied (creating a new image) or simply calculated.  In both cases, statistics for the best focus position (mean, median, minimum, maximum and standard deviation of slices) are stored as measurements associated with the input image.</li><br><li><b>Output image</b> (default = "") Substack image to be added to the current workspace.</li><br><li><b>Best-focus calculation</b> (default = "Largest standard deviation") Method for determining the best-focus slice.<br><ul><li>"Manual" Displays a control window, allowing the user to specify reference slices.  These slices should be at the same true z-plane.  Once complete, a substack will be extracted a specific number of slices above and below the reference plane (defined by "Relative start slice" and "Relative end slice".  If references aren't specific for all timepoints, the missing frames will be estimated using polynomial spline interpolation.</li><li>"Smallest mean intensity" The reference slice is taken as the slice with the minimum mean intensity.</li><li>"Largest mean intensity" The reference slice is taken as the slice with the maximum mean intensity.</li><li>"Smallest standard deviation" The reference slice is taken as the slice with the minimum intensity standard deviation.</li><li>"Largest standard deviation" The reference slice is taken as the slice with the maximum intensity standard deviation.</li></ul></li><br><li><b>Relative start slice</b> (default = "0") Index of start slice relative to determined best-focus slice (i.e. -5 is 5 slices below the best-focus).</li><br><li><b>Relative end slice</b> (default = "0") Index of end slice relative to determined best-focus slice (i.e. 5 is 5 slices above the best-focus).</li><br><li><b>Reference image</b> (default = "") If using manual selection of best focus slices, this is the image that will be shown to the user.  While it doesn't need to be the input image (the one the output substack will be generated from), it must have the same number of slices and timepoints as the input.</li><br><li><b>Calculation source</b> (default = "Internal") When using automatic best focus slice determination this controls the image source:<br><ul><li>"External" The image for which intensity statistics are calculated is different to the image that the final substack will be created from.  For example, this could be an filtered version of the input image to enhance structures when in focus.</li><li>"Internal" The same image will be used for determination of the best slice and generation of the output substack.</li></ul></li><br><li><b>External source</b> (default = "") If using a separate image to determine the best focus slice ("Calculation source" set to "External").</li><br><li><b>Channel mode</b> (default = "Use single channel") How many channels to use when calculating the best-focus slice.  "Use all channels" will use all channels, whereas "Use single channel" will base the calculation on a single, user-defined channel.</li><br><li><b>Channel</b> (default = "1") Channel to base the best-focus calculation on.</li><br><li><b>Smooth timeseries</b> (default = "false") Apply median filter to best focus slice index over time.  This should smooth the transitions over time (prevent large jumps between frames).</li><br><li><b>Smoothing range (odd numbers)</b> (default = "5") Number of frames over which to calculate the median.  If the specified number is even it will be increased by 1.</li><br></ul>

</div>
</body>